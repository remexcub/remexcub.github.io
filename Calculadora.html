
<!-- saved from url=(0012)about:srcdoc -->
<html lang="es"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>window.onmessage = function(event) {event.source.postMessage({iframeId: event.data, scrollHeight: document.body.getBoundingClientRect().height || document.body.scrollHeight}, event.origin);};</script></head><body style="margin: 0;"><div style="display: flex; justify-content: center">



<title>Calculadora M√©xico-Cuba</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(45deg, #3494E6, #EC6EAD);
    margin: 0;
    padding: 15px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding-top: 20px;
  }

  .calculator {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    padding: 25px;
    width: 100%;
    max-width: 380px;
    margin: 5px;
  }

  h1 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1.5em;
  }

  .input-group {
    margin-bottom: 12px;
  }

  label {
    display: block;
    margin-bottom: 5px;
    color: #37474f;
    font-size: 0.9em;
    font-weight: 500;
  }

  select, input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 0.9em;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  select:focus, input:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
  }

  #result {
    margin-top: 15px;
    text-align: center;
    font-weight: bold;
    color: #1a1a1a;
    font-size: 1.3em;
    background-color: #f1f8e9;
    padding: 15px;
    border-radius: 8px;
    border: 2px solid #4caf50;
    transition: all 0.3s ease;
    transform: translateY(0);
  }

  .error {
    color: #d32f2f;
    background-color: #ffebee;
    text-align: center;
    margin-top: 10px;
    font-size: 0.9em;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #f44336;
    transition: all 0.3s ease;
    display: none;
  }

  .info {
    color: #ff6b00;
    text-align: left;
    margin-top: 8px;
    font-size: 0.8em;
    font-weight: bold;
    background-color: #fff3e0;
    padding: 8px;
    border-radius: 6px;
    white-space: pre-line;
  }

  .service-info {
    margin-top: 15px;
    background-color: #e6f3ff;
    color: #0066cc;
    text-align: center;
    font-size: 0.8em;
    font-weight: bold;
    padding: 8px;
    border-radius: 6px;
  }

  .rate-info {
    background-color: #e0f7fa;
    color: #00796b;
    text-align: left;
    margin-top: 8px;
    font-size: 0.8em;
    font-weight: bold;
    padding: 8px;
    border-radius: 6px;
    white-space: pre-line;
  }

  .discount-info {
    background-color: #fff3e0;
    color: #e65100;
    text-align: center;
    margin-top: 10px;
    font-size: 0.9em;
    font-weight: bold;
    padding: 12px;
    border-radius: 8px;
    border: 2px solid #ff9800;
    transition: all 0.4s ease;
    transform: scale(1);
    animation: slideIn 0.5s ease-out;
  }

  .loading {
    background-color: #fff9c4;
    color: #f57f17;
    text-align: center;
    padding: 10px;
    border-radius: 6px;
    margin-top: 10px;
    font-size: 0.85em;
  }

  .update-status {
    background-color: #c8e6c9;
    color: #2e7d32;
    text-align: center;
    padding: 8px;
    border-radius: 6px;
    margin-top: 8px;
    font-size: 0.75em;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  @media screen and (max-width: 400px) {
    body {
      padding: 10px;
      padding-top: 15px;
    }
    
    .calculator {
      width: 95%;
      padding: 20px;
      margin: 0;
      max-width: none;
    }

    h1 {
      font-size: 1.3em;
      margin-bottom: 12px;
    }

    .input-group {
      margin-bottom: 10px;
    }

    #result {
      font-size: 1.2em;
      padding: 12px;
    }

    .discount-info {
      font-size: 0.85em;
      padding: 10px;
    }

    label, select, input, .error, .info, .service-info, .rate-info {
      font-size: 0.85em;
    }
  }
</style>



<div class="calculator">
  <h1>Calculadora M√©xico-Cuba</h1>
  
  <div id="loadingStatus" class="loading" style="display: none;">
    ‚è≥ Cargando tasas actualizadas...
  </div>
  
  <div id="updateStatus" class="update-status" style="display: none; background-color: rgb(200, 230, 201); color: rgb(46, 125, 50);">‚úÖ Tasas actualizadas: 3:10:54 p.m.</div>
  
  <div class="input-group">
    <label>Tipo de Conversi√≥n</label>
    <select id="conversionType">
      <option value="mxn_to_cup">MXN a CUP</option>
      <option value="mxn_to_mlc">MXN a MLC</option>
      <option value="mxn_to_usd">MXN a USD</option>
      <option value="cup_to_mxn">CUP a MXN</option>
      <option value="mlc_to_mxn">MLC a MXN</option>
      <option value="usd_to_mxn">USD a MXN</option>
    </select>
  </div>

  <div class="input-group">
    <label id="inputLabel">Monto en Pesos Mexicanos (MXN)</label>
    <input type="number" id="inputAmount" placeholder="Ingrese el monto" inputmode="numeric">
  </div>

  <div id="result"></div>
  <div id="discountInfo" class="discount-info" style="display: none;"></div>
  <div id="error" class="error" style="display: none;"></div>
  
  <div id="info" class="info">‚ö†Ô∏è IMPORTANTE: 
Manejamos un m√≠nimo de:
<div style="display: flex; flex-wrap: wrap; gap: 4px; margin: 10px 0;">
  <button style="background: #FF5722; color: white; border: none; padding: 8px 10px; border-radius: 20px; font-size: 0.7em; font-weight: bold;">MLC/CUP: 500 MXN üí∞</button>
  <button style="background: #795548; color: white; border: none; padding: 8px 10px; border-radius: 20px; font-size: 0.7em; font-weight: bold;">USD: 50 USD üí≥</button>
  <button style="background: #607D8B; color: white; border: none; padding: 8px 10px; border-radius: 20px; font-size: 0.7em; font-weight: bold;">EE.UU: 100 USD</button>
</div></div>
  
  <div class="rate-info">
    üîÑ Tasas de Cambio Vigentes 
    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0;">
      <button id="cupRateBtn" style="background: #4CAF50; color: white; border: none; padding: 12px 16px; border-radius: 20px; font-size: 0.9em; font-weight: bold;">CUP: 24.05</button>
      <button id="mlcRateBtn" style="background: #2196F3; color: white; border: none; padding: 12px 16px; border-radius: 20px; font-size: 0.9em; font-weight: bold;">MLC: 8.60</button>
      <button id="usdRateBtn" style="background: #FF9800; color: white; border: none; padding: 12px 16px; border-radius: 20px; font-size: 0.9em; font-weight: bold;">USD: 20.40</button>
    </div>
    <button id="discountButton" style="background: #9C27B0; color: white; border: none; padding: 12px 20px; border-radius: 20px; font-size: 0.9em; font-weight: bold; width: 100%; margin-top: 5px;">Descuentos: +3 MXN = 25.05 CUP | +400 MLC = 8.15 MXN</button>
  </div>
  
  <div class="service-info">
    üåü Servicio Garantizado: R√°pido ‚Ä¢ Seguro ‚Ä¢ Confiable ‚Ä¢ Excelencia en Cada Transacci√≥n
  </div>
</div>

<script>
  // ========== CONFIGURACI√ìN ==========
  const GOOGLE_SHEET_ID = '1sDKFXvPq3vO_yHTQGbjrcQ76FFN59PiMJtwZ-ydaadM';
  const GOOGLE_SHEET_URL = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Hoja1`;
  
  // Valores por defecto
  let EXCHANGE_RATES = {
    CUP_NORMAL: 22.50,
    CUP_DISCOUNT: 24.00,
    MLC_NORMAL: 9.00,
    MLC_DISCOUNT: 8.00,
    USD_NORMAL: 20.85,
    CUP_DISCOUNT_FROM: 3001,
    MLC_DISCOUNT_FROM: 400
  };

  let RATES = {};
  let MINIMUMS = {};

  // ========== CARGAR DATOS DESDE GOOGLE SHEETS ==========
  async function loadRatesFromGoogleSheets() {
    const loadingDiv = document.getElementById('loadingStatus');
    const updateDiv = document.getElementById('updateStatus');
    
    try {
      loadingDiv.style.display = 'block';
      
      // Usar modo no-cors con timeout
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 segundos timeout
      
      const response = await fetch(GOOGLE_SHEET_URL, {
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const csvText = await response.text();
      
      // Parsear CSV - Saltar primera l√≠nea (encabezados)
      const lines = csvText.trim().split('\n');
      const newRates = {};
      
      // Empezar desde l√≠nea 1 para saltar el encabezado "Concepto,Valor"
      for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        // Limpiar comillas y espacios
        const cleanLine = line.replace(/"/g, '');
        const parts = cleanLine.split(',');
        
        if (parts.length >= 2) {
          const key = parts[0].trim();
          const value = parseFloat(parts[1].trim());
          
          // Solo agregar si la clave no es "Concepto" y el valor es v√°lido
          if (key && key !== 'Concepto' && !isNaN(value)) {
            newRates[key] = value;
          }
        }
      }
      
      // Validar que tenemos datos
      if (Object.keys(newRates).length >= 5) {
        EXCHANGE_RATES = { ...EXCHANGE_RATES, ...newRates };
        calculateDerivedRates();
        updateUI();
        
        loadingDiv.style.display = 'none';
        updateDiv.textContent = `‚úÖ Tasas actualizadas: ${new Date().toLocaleTimeString('es-MX')}`;
        updateDiv.style.backgroundColor = '#c8e6c9';
        updateDiv.style.color = '#2e7d32';
        updateDiv.style.display = 'block';
        
        setTimeout(() => {
          updateDiv.style.display = 'none';
        }, 5000);
        
        return true;
      } else {
        throw new Error('Datos insuficientes en la hoja');
      }
      
    } catch (error) {
      console.error('Error cargando tasas:', error);
      loadingDiv.style.display = 'none';
      
      // Usar valores por defecto
      calculateDerivedRates();
      updateUI();
      
      updateDiv.textContent = '‚ö†Ô∏è Usando tasas por defecto';
      updateDiv.style.backgroundColor = '#fff3e0';
      updateDiv.style.color = '#e65100';
      updateDiv.style.display = 'block';
      
      setTimeout(() => {
        updateDiv.style.display = 'none';
      }, 5000);
      
      return false;
    }
  }

  // Calcular tasas derivadas
  function calculateDerivedRates() {
    RATES = {
      MXN_TO_CUP: EXCHANGE_RATES.CUP_NORMAL,
      MXN_TO_MLC: 1 / EXCHANGE_RATES.MLC_NORMAL,
      MXN_TO_USD: 1 / EXCHANGE_RATES.USD_NORMAL,
      CUP_TO_MXN: 1 / EXCHANGE_RATES.CUP_NORMAL,
      MLC_TO_MXN: EXCHANGE_RATES.MLC_NORMAL,
      USD_TO_MXN: EXCHANGE_RATES.USD_NORMAL,
      MXN_TO_CUP_DISCOUNT: EXCHANGE_RATES.CUP_DISCOUNT,
      MXN_TO_MLC_DISCOUNT: 1 / EXCHANGE_RATES.MLC_DISCOUNT,
      CUP_TO_MXN_DISCOUNT: 1 / EXCHANGE_RATES.CUP_DISCOUNT,
      MLC_TO_MXN_DISCOUNT: EXCHANGE_RATES.MLC_DISCOUNT
    };

    MINIMUMS = {
      MXN_TO_CUP: 500,
      MXN_TO_MLC: 500,
      MXN_TO_USD: 50 * EXCHANGE_RATES.USD_NORMAL,
      CUP_TO_MXN: 500,
      MLC_TO_MXN: 500,
      USD_TO_MXN: 50 * EXCHANGE_RATES.USD_NORMAL
    };
  }

  // Actualizar interfaz
  function updateUI() {
    updateRateButtons();
    updateDiscountButton();
    convertCurrency();
  }

  const conversionType = document.getElementById('conversionType');
  const inputLabel = document.getElementById('inputLabel');
  const inputAmount = document.getElementById('inputAmount');
  const resultDiv = document.getElementById('result');
  const errorDiv = document.getElementById('error');
  const discountInfoDiv = document.getElementById('discountInfo');

  conversionType.addEventListener('change', updateLabel);
  inputAmount.addEventListener('input', convertCurrency);

  function updateRateButtons() {
    const cupBtn = document.getElementById('cupRateBtn');
    const mlcBtn = document.getElementById('mlcRateBtn');
    const usdBtn = document.getElementById('usdRateBtn');
    
    if (cupBtn) cupBtn.textContent = `CUP: ${EXCHANGE_RATES.CUP_NORMAL.toFixed(2)}`;
    if (mlcBtn) mlcBtn.textContent = `MLC: ${EXCHANGE_RATES.MLC_NORMAL.toFixed(2)}`;
    if (usdBtn) usdBtn.textContent = `USD: ${EXCHANGE_RATES.USD_NORMAL.toFixed(2)}`;
  }

  function updateDiscountButton() {
    const discountButton = document.getElementById('discountButton');
    discountButton.textContent = `Descuentos: +${EXCHANGE_RATES.CUP_DISCOUNT_FROM} MXN = ${EXCHANGE_RATES.CUP_DISCOUNT.toFixed(2)} CUP | +${EXCHANGE_RATES.MLC_DISCOUNT_FROM} MLC = ${EXCHANGE_RATES.MLC_DISCOUNT.toFixed(2)} MXN`;
  }

  function updateLabel() {
    const type = conversionType.value;
    switch(type) {
      case 'mxn_to_cup':
      case 'mxn_to_mlc':
      case 'mxn_to_usd':
        inputLabel.textContent = 'Monto en Pesos Mexicanos (MXN)';
        break;
      case 'cup_to_mxn':
        inputLabel.textContent = 'Monto en Pesos Cubanos (CUP)';
        break;
      case 'mlc_to_mxn':
        inputLabel.textContent = 'Monto en MLC';
        break;
      case 'usd_to_mxn':
        inputLabel.textContent = 'Monto en USD';
        break;
    }
    convertCurrency();
  }

  function convertCurrency() {
    const type = conversionType.value;
    const amount = parseFloat(inputAmount.value);
    
    resultDiv.textContent = '';
    errorDiv.textContent = '';
    errorDiv.style.display = 'none';
    discountInfoDiv.style.display = 'none';

    if (isNaN(amount) || amount <= 0) {
      return;
    }

    let convertedAmount, resultText, hasDiscount = false, discountText = '';

    switch(type) {
      case 'mxn_to_cup':
        if (amount < MINIMUMS.MXN_TO_CUP) {
          errorDiv.textContent = `El monto m√≠nimo de env√≠o es de ${MINIMUMS.MXN_TO_CUP} MXN`;
          errorDiv.style.display = 'block';
          return;
        }
        if (amount >= EXCHANGE_RATES.CUP_DISCOUNT_FROM) {
          convertedAmount = amount * RATES.MXN_TO_CUP_DISCOUNT;
          hasDiscount = true;
          const normalAmount = amount * RATES.MXN_TO_CUP;
          const savings = convertedAmount - normalAmount;
          discountText = `üéâüòä ¬°Descuento aplicado! Recibes ${savings.toFixed(2)} CUP adicionales üéä`;
        } else {
          convertedAmount = amount * RATES.MXN_TO_CUP;
        }
        resultText = `${amount} MXN = ${convertedAmount.toFixed(2)} CUP`;
        break;

      case 'mxn_to_mlc':
        if (amount < MINIMUMS.MXN_TO_MLC) {
          errorDiv.textContent = `El monto m√≠nimo de env√≠o es de ${MINIMUMS.MXN_TO_MLC} MXN`;
          errorDiv.style.display = 'block';
          return;
        }
        convertedAmount = amount * RATES.MXN_TO_MLC;
        resultText = `${amount} MXN = ${convertedAmount.toFixed(2)} MLC`;
        break;

      case 'mxn_to_usd':
        if (amount < MINIMUMS.MXN_TO_USD) {
          errorDiv.textContent = `El monto m√≠nimo de env√≠o es de ${(MINIMUMS.MXN_TO_USD).toFixed(2)} MXN (50 USD)`;
          errorDiv.style.display = 'block';
          return;
        }
        convertedAmount = amount * RATES.MXN_TO_USD;
        resultText = `${amount} MXN = ${convertedAmount.toFixed(2)} USD`;
        break;

      case 'cup_to_mxn':
        convertedAmount = amount * RATES.CUP_TO_MXN;
        if (convertedAmount < MINIMUMS.CUP_TO_MXN) {
          errorDiv.textContent = `El monto convertido debe ser al menos ${MINIMUMS.CUP_TO_MXN} MXN`;
          errorDiv.style.display = 'block';
          return;
        }
        resultText = `${amount} CUP = ${convertedAmount.toFixed(2)} MXN`;
        break;

      case 'mlc_to_mxn':
        if (amount >= EXCHANGE_RATES.MLC_DISCOUNT_FROM) {
          convertedAmount = amount * RATES.MLC_TO_MXN_DISCOUNT;
          hasDiscount = true;
          const normalAmount = amount * RATES.MLC_TO_MXN;
          const savings = normalAmount - convertedAmount;
          discountText = `üéâüòä ¬°Descuento aplicado! Pagas ${savings.toFixed(2)} MXN menos üéä`;
        } else {
          convertedAmount = amount * RATES.MLC_TO_MXN;
        }
        if (convertedAmount < MINIMUMS.MLC_TO_MXN) {
          errorDiv.textContent = `El monto convertido debe ser al menos ${MINIMUMS.MLC_TO_MXN} MXN`;
          errorDiv.style.display = 'block';
          return;
        }
        resultText = `${amount} MLC = ${convertedAmount.toFixed(2)} MXN`;
        break;

      case 'usd_to_mxn':
        convertedAmount = amount * RATES.USD_TO_MXN;
        if (convertedAmount < MINIMUMS.USD_TO_MXN) {
          errorDiv.textContent = `El monto convertido debe ser al menos ${(MINIMUMS.USD_TO_MXN).toFixed(2)} MXN (50 USD)`;
          errorDiv.style.display = 'block';
          return;
        }
        resultText = `${amount} USD = ${convertedAmount.toFixed(2)} MXN`;
        break;
    }

    resultDiv.textContent = resultText;
    
    if (hasDiscount) {
      discountInfoDiv.textContent = discountText;
      discountInfoDiv.style.display = 'block';
    }
  }

  // ========== INICIALIZACI√ìN ==========
  updateLabel();
  
  // Primero usar valores por defecto para que funcione inmediatamente
  calculateDerivedRates();
  updateUI();
  
  // Luego intentar cargar desde Google Sheets
  loadRatesFromGoogleSheets();
  
  // Actualizar cada 5 minutos
  setInterval(loadRatesFromGoogleSheets, 5 * 60 * 1000);
</script>

</div></body></html>